# Copilot / AI Agent instructions for incos_check

This file captures repository-specific knowledge to help AI coding agents be immediately productive.

**Quick Summary**
- **Project type:** Flutter (mobile + desktop); main app in `lib/`.
- **Local DB:** SQLite is the primary persistence layer; see `lib/models/database_helper.dart`.
- **State management:** `provider` + many `ChangeNotifier` viewmodels located under `lib/viewmodels/`.
- **Firebase:** generated config in `lib/firebase_options` and `app/google-services.json` (Firebase deps are currently commented in `pubspec.yaml`).
- **Backend integrations:** `incos_api/` (PHP) and `functions/` (Node.js cloud functions).

**Architecture & Important Files**
- **`lib/main.dart`**: App entrypoint. Registers `DatabaseHelper.instance` and many `ChangeNotifierProvider`s (Auth must initialize early). Use this file to understand provider ordering and app initialization (DB + NotificationService).
- **`lib/models/database_helper.dart`**: Central DDL, migrations, seed data, and helper methods. Database versioning and migrations are implemented here â€” prefer adding schema changes and migrations in this file.
- **`lib/viewmodels/*.dart`**: UI logic lives here and consistently uses `DatabaseHelper.instance` for persistence. New features should follow the `X_viewmodel.dart` -> `XViewModel` pattern.
- **`lib/services/`**: Contains cross-cutting services (e.g., `notification_service.dart`, `theme_service.dart`). Look here for platform integrations.
- **`lib/firebase_options`**: FlutterFire generated file (contains client API keys). If you need to reconfigure Firebase, use the FlutterFire CLI and re-generate this file.
- **`app/google-services.json`**: Android Firebase config; present in repo.
- **`incos_api/` and `functions/`**: External backend code â€” review for API endpoints and message contracts when changing synchronization logic.

**Conventions & Patterns (project-specific)**
- **SQLite-first**: Business logic assumes local SQLite as canonical source. ViewModels interact with `DatabaseHelper` directly. Avoid introducing alternate persistence without migrating data.
- **Migrations live in DB helper**: Add schema changes to `_upgradeDB` and include safe checks (PRAGMA table_info) â€” the code already handles conditional ALTER/CREATE to be idempotent.
- **Provider registration order matters**: `AuthViewModel` is expected to initialize the session early (see `main.dart` FutureBuilder). When adding providers, keep auth and DB providers near the top.
- **Spanish inline guidance + emoji markers**: Developers placed Spanish comments and emoji markers (e.g., `// ðŸŒŸ`). These are useful cues for where behavior was changed/fixed.
- **Dev-only helpers**: `DatabaseHelper.resetDevDB()` and `sqflite_live` usage in dev mode expose a local HTTP inspector at `http://localhost:8888` (adb reverse may be required for device testing).

**Build / Run / Test (essential commands)**
- Get deps: `flutter pub get`
- Run on attached Android device: `flutter run -d <device-id>`
- Run on Windows desktop: `flutter run -d windows`
- Build APK: `flutter build apk --release`
- Run tests: `flutter test`
- If you change the native Android Gradle config: `cd android; .\gradlew assembleDebug` (PowerShell).
- Re-generate Firebase config (if needed): install FlutterFire CLI, then `flutterfire configure` and re-run `flutter pub get`.

**Firebase notes**
- `lib/firebase_options` is generated by FlutterFire CLI. It contains client keys suitable for mobile apps. If you need to change projects, re-run FlutterFire tooling.
- Currently several Firebase packages are commented out in `pubspec.yaml`. To enable Firebase, uncomment required packages (e.g., `firebase_core`, `cloud_firestore`) and run `flutter pub get`.

**Developer tips & gotchas**
- Relative imports: Many files import the DB helper with `../models/database_helper.dart`. When moving files, update those relative paths.
- Secrets: The repo contains client Firebase keys (expected). Do NOT add service-account JSONs or private keys to the repo. Use CI/secret managers for private credentials.
- DB migrations are conservative: they try to ALTER only if missing. When adding columns/tables, include checks to avoid runtime errors on existing installs.
- When testing on a physical Android device and using `sqflite_live`, run `adb reverse tcp:8888 tcp:8888` so `http://localhost:8888` on host becomes reachable from device.

**Where to look for examples**
- Add new DB migration: follow patterns in `lib/models/database_helper.dart` (`_upgradeDB`, `_createDB`, `_runDDL`).
- Add a new viewmodel: copy pattern from `lib/viewmodels/estudiantes_viewmodel.dart` and register it in `lib/main.dart` using `ChangeNotifierProvider`.
- Add remote integration: inspect `incos_api/` for expected endpoints and `lib/services/` for HTTP client usage.

If anything important is missing or unclear here, tell me which part you want expanded (e.g., sample code for adding a migration, how to run the dev DB inspector, or CI deploy steps).
